
# VK Education Practice

Автор: Васюков Александр

Проект реализуется в рамках летней практики НИУ ВШЭ в комапнии VK.

---

## Описание проекта

Разработать модель машинного обучения, которая будет предсказывать пол пользователя соцсетей. Это необходимо, чтобы реклама была эффективной: демонстрировалась пользователям соответствующего гендера. 

Условия задачи на сайта [All Cups](https://cups.online/ru/tasks/1923).

## Данные

#### train_labels.csv

- `user_id` - id пользователя
- `target` - целевая переменная (0 - мужчина, 1 - женщина)

#### train.csv и test.csv

- `request_ts` - время запроса
- `user_id` - id пользователя
- `referer` - URL рекламы
- `geo_id` - ID геолокации
- `user_agent` - информация об устройстве, браузере

Один пользователь может быть записан несколько раз.


#### referer_vectors.csv

- `conponent<i>` - признаки ($i \in [0, 9] $)
- `referer` - URL рекламы

#### geo_info.csv

- `geo_id` - ID геолокации
- `country_id` - ID страны
- `region_id` - ID региона
- `timezone_id` - ID часового пояса

#### test_users.csv

- `user_id` - ID пользователя

---

## План работы

1. Обработка данных
2. Обучение модели
3. Результат

---

### 1. Обработка данных

Нам необходимо собрать датасет, в котором будет вся информация о пользователях: геопозиция, страна, регион, часовой пояс, рекламные запросы, параметры рекламы и таргет.

Пусть, таргет: \
0 - мужчина \
1 - женщина


Собираем данные в один датасет. Используем функцию `merge` для слияния таблиц. Также создаем новые признаки:

1. Вытягиваем `domain` из запроса `referer`
2. Преобразуем `request_ts` в час запроса `hour`

Преобразуем признак `user_agent` в признаки:

- `browser` - браузер, с которого был сделан запрос
- `os` - операционная система устройства
- `browser_version` - версия браузера
- `os_version` - версия операционной системы

Проводя тестирование, оказалось, что признаки версии бразуера и операционной системы не дают никаких преимуществ.

Пропуски в признаке региона `region_id` заполняем значением страны `country_id`. Остальные пропуски заполняем значением none.

После получения признаков для каждого запроса, группируем данные по пользователям. Для этого используем аггрегацию с параметрами по признакам:

- Наиболее частый для признаков:
    - `browser` - браузер
    - `os` - ОС
    - `hour` - час запроса
    - `domain` - домен сайта
    - `country_id` - страна
    - `region_id` - регион
    - `timezone_id` - часовой пояс

- Среднее значение:
    - Для признаков `component<i>`

К полученым пользователям добавляем их таргет. Удаляем те объекты, которые не имеют значения целевой переменной.

<img src="/Users/alexvasyukov/Desktop/VK Education Practice/scheme.png" alt="scheme" style="width: 800px;"/>

---

### 2. Обучение модели

Делим данные на тренировочную, валидационную и тестовую выборку в соотношении 8:1:1.

Используем `StandardScaler` для масштабирования вещественных признаков и объединяем полученные признаки. 

Используем `Pool` из catboost для категориальных признаков.

Настраиваем гиперпараметры классификатора CatBoostClassifier:
- iterations=1500
- early_stopping_rounds=15
- auto_class_weights='Balanced'
- random_seed=42
- verbose=100

И обучаем модель.

---

### 3. Результат:

Спрогнозированные метки пользователей записаны в файл `data/result.csv`.

Data  | AUC-ROC | Accuracy
------|---------|---------
Train | 0.9030  | 0.9033
Test  | 0.8760  | 0.8762

В итоге полученная модель имеет качество на тестовых данных:
- Accuracy - 87.6%
- ROC-AUC - 87.6%